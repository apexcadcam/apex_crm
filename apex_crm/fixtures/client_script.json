[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2024-05-12 10:20:57.417932",
  "module": "Apex CRM",
  "name": "Lead Show Hide Comment",
  "script": "frappe.ui.form.on('Lead', {\n    \n\trefresh(frm) {\n\t\t// your code here\n\nfrm.doc.notes.forEach(function(row,index) {\n    if(frappe.session.user!=row.added_by){\n            console.log(frappe.session.user)\n    console.log(index)\n\n        $(document).ready(function() {\n          $(\".notes-section\").find(\".delete-note-btn\").eq(cur_frm.doc.notes.length-index-1).hide();\n          $(\".notes-section\").find(\".edit-note-btn\").eq(cur_frm.doc.notes.length-index-1).hide();\n        });\n    }\n});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2024-03-03 16:02:17.023863",
  "module": "Apex CRM",
  "name": "Opportunity Show Hide Comment",
  "script": "frappe.ui.form.on('Opportunity', {\n\trefresh(frm) {\n\t\t// your code here\n\nfrm.doc.notes.forEach(function(row,index) {\n    if(frappe.session.user!=row.added_by){\n            console.log(frappe.session.user)\n    console.log(index)\n\n        $(document).ready(function() {\n          $(\".notes-section\").find(\".delete-note-btn\").eq(cur_frm.doc.notes.length-index-1).hide();\n          $(\".notes-section\").find(\".edit-note-btn\").eq(cur_frm.doc.notes.length-index-1).hide();\n        });\n    }\n});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 0,
  "modified": "2025-12-21 08:13:17.197185",
  "module": "Apex CRM",
  "name": "lead fixtures",
  "script": "frappe.ui.form.on('Lead', {\r\n    setup(frm) {\r\n        frm.trigger(\"SearchHandelr\")\r\n    },\r\n    refresh(frm) {\r\n        frm.set_value(\"request_type\", 'Product Enquiry')\r\n        hide_standard_fields(frm)\r\n        if (frm.doc.lead_name) {\r\n            if (!frm.doc.custom_full_name || (frm.doc.custom_full_name !== frm.doc.first_name)) {\r\n                frm.set_value(\"first_name\", \"\")\r\n                frm.set_value(\"middle_name\", \"\")\r\n                frm.set_value(\"last_name\", \"\")\r\n                frm.set_value(\"custom_full_name\", frm.doc.lead_name.replace(frm.doc.salutation + \" \", \"\"))\r\n                frm.save()\r\n\r\n            }\r\n        }\r\n        if (!frm.doc.name.includes(\"new-lead\")) {\r\n            cur_frm.meta.fields.map(m => {\r\n                try {\r\n                    if (cur_frm.fields_dict[m.fieldname].value) {\r\n                        return m.fieldname\r\n                    }\r\n                } catch (error) {\r\n                }\r\n            }\r\n            ).filter(r => r !== undefined && r !== \"custom_lead_search\").forEach(r => {\r\n                frm.set_df_property(r, 'read_only', 1)\r\n            }\r\n            )\r\n            frm.add_custom_button(__('Edit'), function () {\r\n                cur_frm.meta.fields.map(m => {\r\n                    try {\r\n                        if (cur_frm.fields_dict[m.fieldname].value) {\r\n                            return m.fieldname\r\n                        }\r\n                    } catch (error) {\r\n                    }\r\n                }\r\n                ).filter(r => r !== undefined && r !== \"custom_lead_search\").forEach(r => {\r\n                    frm.set_df_property(r, 'read_only', 0)\r\n                }\r\n                )\r\n            });\r\n        }\r\n\r\n\r\n    },\r\n    validate(frm) {\r\n        frm.set_value(\"custom_lead_search\", \"\")\r\n    },\r\n    custom_full_name(frm) {\r\n        if (frm.doc.custom_full_name !== frm.doc.first_name) {\r\n            frm.set_value(\"first_name\", \"\")\r\n            frm.set_value(\"first_name\", frm.doc.custom_full_name)\r\n        }\r\n\r\n    },\r\n    custom_lead_search(frm) {\r\n        if (frm.get_field(\"custom_lead_search\").value) {\r\n            var isMatchLead = frm.get_field(\"custom_lead_search\").awesomplete.suggestions.find(item => item.value == frm.get_field(\"custom_lead_search\").value)\r\n            if (isMatchLead) {\r\n                frappe.set_route('Form', 'Lead', frm.get_field(\"custom_lead_search\").value)\r\n            }\r\n\r\n        }\r\n    },\r\n    SearchHandelr(frm) {\r\n        frappe.ui.form.LinkSelector = class extends frappe.ui.form.LinkSelector {\r\n            make() {\r\n                var me = this;\r\n                if (this.target._label === \"Lead Search\") {\r\n                    frappe.ui.form.LinkSelector.prototype.search = LeadSearch.bind(this);\r\n                    frappe.link_search = LeadLinkSearch;\r\n                } else {\r\n                    frappe.ui.form.LinkSelector.prototype.search = StandardSearch.bind(this);\r\n                    frappe.link_search = StandardLinkSearch;\r\n                }\r\n\r\n                this.start = 0;\r\n                this.page_length = 10;\r\n                this.dialog = new frappe.ui.Dialog({\r\n                    title: __(\"Select {0}\", [this.doctype == \"[Select]\" ? __(\"value\") : __(this.doctype)]),\r\n                    fields: [\r\n                        {\r\n                            fieldtype: \"Data\",\r\n                            fieldname: \"txt\",\r\n                            label: __(\"Beginning with\"),\r\n                            description: __(\"You can use wildcard %\"),\r\n                        },\r\n                        {\r\n                            fieldtype: \"HTML\",\r\n                            fieldname: \"results\",\r\n                        },\r\n                        {\r\n                            fieldtype: \"Button\",\r\n                            fieldname: \"more\",\r\n                            label: __(\"More\"),\r\n                            click: () => {\r\n                                me.start += me.page_length;\r\n                                me.search();\r\n                            },\r\n                        },\r\n                    ],\r\n                    primary_action_label: __(\"Search\"),\r\n                    primary_action: function () {\r\n                        me.start = 0;\r\n                        me.search();\r\n                    },\r\n                });\r\n\r\n                if (this.txt) this.dialog.fields_dict.txt.set_input(this.txt);\r\n\r\n                this.dialog.get_input(\"txt\").on(\"keypress\", function (e) {\r\n                    if (e.which === 13) {\r\n                        me.start = 0;\r\n                        me.search();\r\n                    }\r\n                });\r\n                this.dialog.show();\r\n                this.search();\r\n            }\r\n        };\r\n        frm.get_field('custom_lead_search').setup_awesomeplete = function () {\r\n            let me = this;\r\n\r\n            me.$input.cache = {};\r\n\r\n            this.awesomplete = new Awesomplete(me.input, {\r\n                tabSelect: true,\r\n                minChars: 0,\r\n                maxItems: 99,\r\n                autoFirst: true,\r\n                list: [],\r\n                replace: function (item) {\r\n                    // Override Awesomeplete replace function as it is used to set the input value\r\n                    // https://github.com/LeaVerou/awesomplete/issues/17104#issuecomment-359185403\r\n                    this.input.value = me.get_translated(item.label || item.value);\r\n                },\r\n                data: function (item) {\r\n                    return {\r\n                        label: me.get_translated(item.label || item.value),\r\n                        value: item.value,\r\n                    };\r\n                },\r\n                filter: function () {\r\n                    return true;\r\n                },\r\n                item: function (item) {\r\n                    let d = this.get_item(item.value);\r\n                    if (!d.label) {\r\n                        d.label = d.value;\r\n                    }\r\n\r\n                    let _label = me.get_translated(d.label);\r\n                    let html = d.html || \"<strong>\" + _label + \"</strong>\";\r\n                    if (d.description && // for title links, we want to inlude the value in the description\r\n                        // because it will not visible otherwise\r\n                        (me.is_title_link() || d.value !== d.description)) {\r\n                        html += '<br><span class=\"small\">' + __(d.description[0]) + \"</span>\" + '<br><span class=\"small\">' + __([...new Set(d.description[1].split(\", \"))].join(\", \")) + \"</span>\";\r\n                    }\r\n                    return $(`<div role=\"option\">`).on(\"click\", (event) => {\r\n                        me.awesomplete.select(event.currentTarget, event.currentTarget);\r\n                    }\r\n                    ).data(\"item.autocomplete\", d).prop(\"aria-selected\", \"false\").html(`<p title=\"${frappe.utils.escape_html(_label)}\">${html}</p>`).get(0);\r\n                },\r\n                sort: function () {\r\n                    return 0;\r\n                },\r\n            });\r\n\r\n            this.custom_awesomplete_filter && this.custom_awesomplete_filter(this.awesomplete);\r\n\r\n            this.$input.on(\"input\", frappe.utils.debounce(function (e) {\r\n                var doctype = me.get_options();\r\n                if (!doctype)\r\n                    return;\r\n                if (!me.$input.cache[doctype]) {\r\n                    me.$input.cache[doctype] = {};\r\n                }\r\n\r\n                var term = e.target.value;\r\n\r\n                if (me.$input.cache[doctype][term] != null) {\r\n                    // immediately show from cache\r\n                    me.awesomplete.list = me.$input.cache[doctype][term];\r\n                }\r\n                var args = {\r\n                    txt: term,\r\n                    doctype: doctype,\r\n                    ignore_user_permissions: me.df.ignore_user_permissions,\r\n                    reference_doctype: me.get_reference_doctype() || \"\",\r\n                    page_length: cint(frappe.boot.sysdefaults?.link_field_results_limit) || 10,\r\n                };\r\n\r\n                me.set_custom_query(args);\r\n\r\n                frappe.call({\r\n                    method: 'frappe.client.get_list',\r\n                    args: {\r\n                        doctype: 'Lead',\r\n                        fields: ['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'],\r\n                        or_filters: generateWildcardFilters(['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'], 'like', term),\r\n                        page_length: 10\r\n                    },\r\n                    callback: function (r) {\r\n                        if (r.message) {\r\n                            r.message = r.message.map(({ name, lead_name, custom_mobile_number_1, custom_mobile_number_2, custom_whatsapp_number }) => {\r\n                                var description = Object.values({\r\n                                    custom_mobile_number_1,\r\n                                    custom_mobile_number_2,\r\n                                    custom_whatsapp_number\r\n                                }).filter(value => value != null && value !== \"\").join(\", \").replaceAll(\"-\", \" \")\r\n                                return {\r\n                                    value: name,\r\n                                    description: [lead_name, description]\r\n                                }\r\n                            }\r\n                            )\r\n                        }\r\n                        if (!window.Cypress && !me.$input.is(\":focus\")) {\r\n                            return;\r\n                        }\r\n                        r.message = me.merge_duplicates(r.message);\r\n\r\n                        // show filter description in awesomplete\r\n                        let filter_string = me.df.filter_description ? me.df.filter_description : args.filters ? me.get_filter_description(args.filters) : null;\r\n                        if (filter_string) {\r\n                            r.message.push({\r\n                                html: `<span class=\"text-muted\" style=\"line-height: 1.5\">${filter_string}</span>`,\r\n                                value: \"\",\r\n                                action: () => { }\r\n                                ,\r\n                            });\r\n                        }\r\n\r\n                        if (!me.df.only_select) {\r\n                            if (frappe.model.can_create(doctype)) {\r\n                                // new item\r\n                                r.message.push({\r\n                                    html: \"<span class='link-option'>\" + \"<i class='fa fa-plus' style='margin-right: 5px;'></i> \" + __(\"Create a new {0}\", [__(me.get_options())]) + \"</span>\",\r\n                                    label: __(\"Create a new {0}\", [__(me.get_options())]),\r\n                                    value: \"create_new__link_option\",\r\n                                    action: me.new_doc,\r\n                                });\r\n                            }\r\n\r\n                            //custom link actions\r\n                            let custom__link_options = frappe.ui.form.ControlLink.link_options && frappe.ui.form.ControlLink.link_options(me);\r\n\r\n                            if (custom__link_options) {\r\n                                r.message = r.message.concat(custom__link_options);\r\n                            }\r\n\r\n                            // advanced search\r\n                            if (locals && locals[\"DocType\"]) {\r\n                                // not applicable in web forms\r\n                                r.message.push({\r\n                                    html: \"<span class='link-option'>\" + \"<i class='fa fa-search' style='margin-right: 5px;'></i> \" + __(\"Advanced Search\") + \"</span>\",\r\n                                    label: __(\"Advanced Search\"),\r\n                                    value: \"advanced_search__link_option\",\r\n                                    action: me.open_advanced_search,\r\n                                });\r\n                            }\r\n                        }\r\n                        me.$input.cache[doctype][term] = r.message;\r\n                        me.awesomplete.list = me.$input.cache[doctype][term];\r\n                        me.toggle_href(doctype);\r\n                        r.message.forEach((item) => {\r\n                            frappe.utils.add_link_title(doctype, item.value, item.label);\r\n                        }\r\n                        );\r\n                    },\r\n                });\r\n            }, 500));\r\n\r\n            this.$input.on(\"blur\", function () {\r\n                if (me.selected) {\r\n                    me.selected = false;\r\n                    return;\r\n                }\r\n                let value = me.get_input_value();\r\n                let label = me.get_label_value();\r\n                let last_value = me.last_value || \"\";\r\n                let last_label = me.label || \"\";\r\n\r\n                if (value !== last_value) {\r\n                    me.parse_validate_and_set_in_model(value, null, label);\r\n                }\r\n            });\r\n\r\n            this.$input.on(\"awesomplete-open\", () => {\r\n                this.autocomplete_open = true;\r\n\r\n                if (!me.get_label_value()) {\r\n                    // hide link arrow to doctype if none is set\r\n                    me.$link.toggle(false);\r\n                }\r\n            }\r\n            );\r\n\r\n            this.$input.on(\"awesomplete-close\", (e) => {\r\n                this.autocomplete_open = false;\r\n\r\n                if (!me.get_label_value()) {\r\n                    // hide link arrow to doctype if none is set\r\n                    me.$link.toggle(false);\r\n                }\r\n            }\r\n            );\r\n\r\n            this.$input.on(\"awesomplete-select\", function (e) {\r\n                var o = e.originalEvent;\r\n                var item = me.awesomplete.get_item(o.text.value);\r\n\r\n                me.autocomplete_open = false;\r\n\r\n                // prevent selection on tab\r\n                let TABKEY = 9;\r\n                if (e.keyCode === TABKEY) {\r\n                    e.preventDefault();\r\n                    me.awesomplete.close();\r\n                    return false;\r\n                }\r\n\r\n                if (item.action) {\r\n                    item.value = \"\";\r\n                    item.label = \"\";\r\n                    item.action.apply(me);\r\n                }\r\n\r\n                // if remember_last_selected is checked in the doctype against the field,\r\n                // then add this value\r\n                // to defaults so you do not need to set it again\r\n                // unless it is changed.\r\n                if (me.df.remember_last_selected_value) {\r\n                    frappe.boot.user.last_selected_values[me.df.options] = item.value;\r\n                }\r\n\r\n                me.parse_validate_and_set_in_model(item.value, null, item.label);\r\n            });\r\n\r\n            this.$input.on(\"awesomplete-selectcomplete\", function (e) {\r\n                let o = e.originalEvent;\r\n                if (o.text.value.indexOf(\"__link_option\") !== -1) {\r\n                    me.$input.val(\"\");\r\n                }\r\n            });\r\n        }\r\n        frm.get_field('custom_lead_search').setup_awesomeplete()\r\n\r\n        frm.get_field(\"custom_lead_search\").$input.off(\"input\");\r\n        const field = frm.get_field('custom_lead_search');\r\n        field.$input.on(\"input\", frappe.utils.debounce(function (e) {\r\n            var me = field\r\n            var doctype = me.get_options();\r\n            if (!doctype)\r\n                return;\r\n            if (!me.$input.cache[doctype]) {\r\n                me.$input.cache[doctype] = {};\r\n            }\r\n\r\n            var term = e.target.value;\r\n\r\n            if (me.$input.cache[doctype][term] != null) {\r\n                // immediately show from cache\r\n                me.awesomplete.list = me.$input.cache[doctype][term];\r\n            }\r\n            var args = {\r\n                txt: term,\r\n                doctype: doctype,\r\n                ignore_user_permissions: me.df.ignore_user_permissions,\r\n                reference_doctype: me.get_reference_doctype() || \"\",\r\n                page_length: cint(frappe.boot.sysdefaults?.link_field_results_limit) || 10,\r\n            };\r\n\r\n            me.set_custom_query(args);\r\n\r\n            frappe.call({\r\n                method: 'frappe.client.get_list',\r\n                args: {\r\n                    doctype: 'Lead',\r\n                    fields: ['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'],\r\n                    or_filters: generateWildcardFilters(['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'], 'like', term),\r\n                    page_length: 10\r\n                },\r\n                callback: function (r) {\r\n                    if (r.message) {\r\n                        r.message = r.message.map(({ name, lead_name, custom_mobile_number_1, custom_mobile_number_2, custom_whatsapp_number }) => {\r\n                            var description = Object.values({\r\n                                custom_mobile_number_1,\r\n                                custom_mobile_number_2,\r\n                                custom_whatsapp_number\r\n                            }).filter(value => value != null && value !== \"\").join(\", \").replaceAll(\"-\", \" \")\r\n                            return {\r\n                                value: name,\r\n                                description: [lead_name, description]\r\n                            }\r\n                        }\r\n                        )\r\n                    }\r\n                    if (!window.Cypress && !me.$input.is(\":focus\")) {\r\n                        return;\r\n                    }\r\n                    r.message = me.merge_duplicates(r.message);\r\n\r\n                    // show filter description in awesomplete\r\n                    let filter_string = me.df.filter_description ? me.df.filter_description : args.filters ? me.get_filter_description(args.filters) : null;\r\n                    if (filter_string) {\r\n                        r.message.push({\r\n                            html: `<span class=\"text-muted\" style=\"line-height: 1.5\">${filter_string}</span>`,\r\n                            value: \"\",\r\n                            action: () => { }\r\n                            ,\r\n                        });\r\n                    }\r\n\r\n                    if (!me.df.only_select) {\r\n                        if (frappe.model.can_create(doctype)) {\r\n                            // new item\r\n                            r.message.push({\r\n                                html: \"<span class='link-option'>\" + \"<i class='fa fa-plus' style='margin-right: 5px;'></i> \" + __(\"Create a new {0}\", [__(me.get_options())]) + \"</span>\",\r\n                                label: __(\"Create a new {0}\", [__(me.get_options())]),\r\n                                value: \"create_new__link_option\",\r\n                                action: me.new_doc,\r\n                            });\r\n                        }\r\n\r\n                        //custom link actions\r\n                        let custom__link_options = frappe.ui.form.ControlLink.link_options && frappe.ui.form.ControlLink.link_options(me);\r\n\r\n                        if (custom__link_options) {\r\n                            r.message = r.message.concat(custom__link_options);\r\n                        }\r\n\r\n                        // advanced search\r\n                        if (locals && locals[\"DocType\"]) {\r\n                            // not applicable in web forms\r\n                            r.message.push({\r\n                                html: \"<span class='link-option'>\" + \"<i class='fa fa-search' style='margin-right: 5px;'></i> \" + __(\"Advanced Search\") + \"</span>\",\r\n                                label: __(\"Advanced Search\"),\r\n                                value: \"advanced_search__link_option\",\r\n                                action: me.open_advanced_search,\r\n                            });\r\n                        }\r\n                    }\r\n                    me.$input.cache[doctype][term] = r.message;\r\n                    me.awesomplete.list = me.$input.cache[doctype][term];\r\n                    me.toggle_href(doctype);\r\n                    r.message.forEach((item) => {\r\n                        frappe.utils.add_link_title(doctype, item.value, item.label);\r\n                    }\r\n                    );\r\n                },\r\n            });\r\n        }, 500))\r\n\r\n    }\r\n\r\n});\r\nfunction hide_standard_fields(frm) {\r\n    frm.set_df_property(\"lead_name\", \"hidden\", 1)\r\n    frm.set_df_property(\"first_name\", \"hidden\", 1)\r\n    frm.set_df_property(\"middle_name\", \"hidden\", 1)\r\n    frm.set_df_property(\"last_name\", \"hidden\", 1)\r\n    frm.set_df_property(\"request_type\", \"hidden\", 1)\r\n}\r\nfunction generateWildcardFilters(fieldsObjKeys, operator, txt) {\r\n    const result = [];\r\n    fieldsObjKeys.forEach(fieldKey => {\r\n        result.push([fieldKey, operator, `%${txt}`], // Ends with\r\n            [fieldKey, operator, `${txt}%`], // Starts with\r\n            [fieldKey, operator, `%${txt}%`]// Contains\r\n        );\r\n    }\r\n    );\r\n\r\n    return result;\r\n}\r\n\r\n\r\n\r\n\r\nfunction StandardSearch() {\r\n    var args = {\r\n        txt: this.dialog.fields_dict.txt.get_value(),\r\n        searchfield: \"name\",\r\n        start: this.start,\r\n        page_length: this.page_length,\r\n    };\r\n    var me = this;\r\n\r\n    if (this.target.set_custom_query) {\r\n        this.target.set_custom_query(args);\r\n    }\r\n\r\n    // load custom query from grid\r\n    if (\r\n        this.target.is_grid &&\r\n        this.target.fieldinfo[this.fieldname] &&\r\n        this.target.fieldinfo[this.fieldname].get_query\r\n    ) {\r\n        $.extend(args, this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc));\r\n    }\r\n\r\n    frappe.link_search(\r\n        this.doctype,\r\n        args,\r\n        function (results) {\r\n            var parent = me.dialog.fields_dict.results.$wrapper;\r\n            if (args.start === 0) {\r\n                parent.empty();\r\n            }\r\n\r\n            if (results.length) {\r\n                for (const v of results) {\r\n                    var row = $(\r\n                        repl(\r\n                            '<div class=\"row link-select-row\">\\\r\n\t\t\t\t\t\t<div class=\"col-xs-4\">\\\r\n\t\t\t\t\t\t\t<b><a href=\"#\">%(name)s</a></b></div>\\\r\n\t\t\t\t\t\t<div class=\"col-xs-8\">\\\r\n\t\t\t\t\t\t\t<span class=\"text-muted\">%(values)s</span></div>\\\r\n\t\t\t\t\t\t</div>',\r\n                            {\r\n                                name: v[0],\r\n                                values: v.splice(1).join(\", \"),\r\n                            }\r\n                        )\r\n                    ).appendTo(parent);\r\n\r\n                    row.find(\"a\")\r\n                        .attr(\"data-value\", v[0])\r\n                        .click(function () {\r\n                            var value = $(this).attr(\"data-value\");\r\n                            if (me.target.is_grid) {\r\n                                // set in grid\r\n                                // call search after value is set to get latest filtered results\r\n                                me.set_in_grid(value).then(() => me.search());\r\n                            } else {\r\n                                if (me.target.doctype)\r\n                                    me.target.parse_validate_and_set_in_model(value);\r\n                                else {\r\n                                    me.target.set_input(value);\r\n                                    me.target.$input.trigger(\"change\");\r\n                                }\r\n                                me.dialog.hide();\r\n                            }\r\n                            return false;\r\n                        });\r\n                }\r\n            } else {\r\n                $(\r\n                    '<p><br><span class=\"text-muted\">' +\r\n                    __(\"No Results\") +\r\n                    \"</span>\" +\r\n                    (frappe.model.can_create(me.doctype)\r\n                        ? '<br><br><a class=\"new-doc btn btn-default btn-sm\">' +\r\n                        __(\"Create a new {0}\", [__(me.doctype)]) +\r\n                        \"</a>\"\r\n                        : \"\") +\r\n                    \"</p>\"\r\n                )\r\n                    .appendTo(parent)\r\n                    .find(\".new-doc\")\r\n                    .click(function () {\r\n                        frappe.new_doc(me.doctype);\r\n                    });\r\n            }\r\n\r\n            var more_btn = me.dialog.fields_dict.more.$wrapper;\r\n            if (results.length < me.page_length) {\r\n                more_btn.hide();\r\n            } else {\r\n                more_btn.show();\r\n            }\r\n        },\r\n        this.dialog.get_primary_btn()\r\n    );\r\n}\r\n\r\n\r\nfunction StandardLinkSearch(doctype, args, callback, btn) {\r\n    if (!args) {\r\n        args = {\r\n            txt: \"\",\r\n        };\r\n    }\r\n    args.doctype = doctype;\r\n    if (!args.searchfield) {\r\n        args.searchfield = \"name\";\r\n    }\r\n\r\n    frappe.call({\r\n        method: \"frappe.desk.search.search_widget\",\r\n        type: \"GET\",\r\n        args: args,\r\n        callback: function (r) {\r\n            callback && callback(r.message);\r\n        },\r\n        btn: btn,\r\n    });\r\n};\r\n\r\n\r\nfunction LeadSearch() {\r\n    var args = {\r\n        txt: this.dialog.fields_dict.txt.get_value(),\r\n        searchfield: \"name\",\r\n        start: this.start,\r\n        page_length: this.page_length,\r\n    };\r\n    var me = this;\r\n\r\n    if (this.target.set_custom_query) {\r\n        this.target.set_custom_query(args);\r\n    }\r\n\r\n    // load custom query from grid\r\n    if (this.target.is_grid && this.target.fieldinfo[this.fieldname] && this.target.fieldinfo[this.fieldname].get_query) {\r\n        $.extend(args, this.target.fieldinfo[this.fieldname].get_query(frm.doc));\r\n    }\r\n\r\n    frappe.link_search(this.doctype, args, function (results) {\r\n        var parent = me.dialog.fields_dict.results.$wrapper;\r\n        if (args.start === 0) {\r\n            parent.empty();\r\n        }\r\n\r\n        if (results.length) {\r\n            for (const v of results) {\r\n                const valueSpans = [...new Set(v.slice(1))].map(val => `<span class=\"text-muted\">${val.replace(\"-\", \" \")}</span>`).join('<br/>');\r\n                // Join with <br/> for line breaks\r\n\r\n                const row = $(`\r\n                      <div class=\"row link-select-row\">\r\n                        <div class=\"col-xs-4\">\r\n                          <b><a href=\"#\">${v[0]}</a></b>\r\n                        </div>\r\n                        <div class=\"col-xs-8\">\r\n                          ${valueSpans}\r\n                        </div>\r\n                      </div>\r\n                    `).appendTo(parent);\r\n\r\n                row.find(\"a\").attr(\"data-value\", v[0]).click(function () {\r\n                    var value = $(this).attr(\"data-value\");\r\n                    if (me.target.is_grid) {\r\n                        // set in grid\r\n                        // call search after value is set to get latest filtered results\r\n                        me.set_in_grid(value).then(() => me.search());\r\n                    } else {\r\n                        if (me.target.doctype)\r\n                            me.target.parse_validate_and_set_in_model(value);\r\n                        else {\r\n                            me.target.set_input(value);\r\n                            me.target.$input.trigger(\"change\");\r\n                        }\r\n                        me.dialog.hide();\r\n                    }\r\n                    return false;\r\n                });\r\n            }\r\n        } else {\r\n            $('<p><br><span class=\"text-muted\">' + __(\"No Results\") + \"</span>\" + (frappe.model.can_create(me.doctype) ? '<br><br><a class=\"new-doc btn btn-default btn-sm\">' + __(\"Create a new {0}\", [__(me.doctype)]) + \"</a>\" : \"\") + \"</p>\").appendTo(parent).find(\".new-doc\").click(function () {\r\n                frappe.new_doc(me.doctype);\r\n            });\r\n        }\r\n\r\n        var more_btn = me.dialog.fields_dict.more.$wrapper;\r\n        if (results.length < me.page_length) {\r\n            more_btn.hide();\r\n        } else {\r\n            more_btn.show();\r\n        }\r\n    }, this.dialog.get_primary_btn());\r\n}\r\n\r\nfunction LeadLinkSearch(doctype, args, callback, btn) {\r\n    if (!args) {\r\n        args = {\r\n            txt: \"\",\r\n        };\r\n    }\r\n    args.doctype = doctype;\r\n    if (!args.searchfield) {\r\n        args.searchfield = \"name\";\r\n    }\r\n\r\n    frappe.call({\r\n        method: 'frappe.client.get_list',\r\n        args: {\r\n            doctype: 'Lead',\r\n            fields: ['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'],\r\n            or_filters: generateWildcardFilters(['name', 'lead_name', 'custom_mobile_number_1', 'custom_mobile_number_2', 'custom_whatsapp_number'], 'like', args.txt),\r\n            page_length: 10\r\n        },\r\n        callback: function (r) {\r\n            if (r.message) {\r\n                r.message = r.message.map(({ name, lead_name, custom_mobile_number_1, custom_mobile_number_2, custom_whatsapp_number }) => {\r\n                    return Object.values({\r\n                        name,\r\n                        lead_name,\r\n                        custom_mobile_number_1,\r\n                        custom_mobile_number_2,\r\n                        custom_whatsapp_number\r\n                    }).filter(value => value != null && value !== \"\")\r\n\r\n                }\r\n                )\r\n            }\r\n            callback && callback(r.message);\r\n        },\r\n        btn: btn,\r\n    });\r\n};\r\n\r\n\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-08-10 15:32:20.573050",
  "module": "Apex CRM",
  "name": "Hide Status",
  "script": "frappe.listview_settings['Lead'] = {\r\n    onload: function(listview) {\r\n        // Filter out the 'status' column from the visible fields\r\n        listview.meta.fields = listview.meta.fields.filter(function(field) {\r\n            return field.fieldname !== 'status';\r\n        });\r\n\r\n        // Also remove from the listview's visible columns if already loaded\r\n        if (listview.fields_dict && listview.fields_dict.status) {\r\n            delete listview.fields_dict.status;\r\n        }\r\n    }\r\n};\r\n",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-08-11 10:38:15.367454",
  "module": "Apex CRM",
  "name": "Hide Lead ID",
  "script": "frappe.listview_settings['Lead'] = {\r\nhide_name_column : true,\r\n}",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 0,
  "modified": "2025-12-21 08:04:31.350595",
  "module": "Apex CRM",
  "name": "Lead Icons phone whatsapp",
  "script": "frappe.ui.form.on('Lead', {\r\n    refresh(frm) {\r\n        // Mobile Number 1\r\n        if (frm.doc.custom_mobile_number_1) {\r\n            let phone_number_1 = frm.doc.custom_mobile_number_1;\r\n            let cleaned_number_1 = phone_number_1.replace(/[\\s\\-\\(\\)\\+]/g, '');\r\n            \r\n            let phone_field_1 = frm.fields_dict.custom_mobile_number_1;\r\n            if (phone_field_1 && phone_field_1.$wrapper) {\r\n                phone_field_1.$wrapper.find('.custom-contact-icons').remove();\r\n                \r\n                let input_wrapper = phone_field_1.$wrapper.find('.control-input-wrapper');\r\n                if (input_wrapper.length) {\r\n                    input_wrapper.css('display', 'flex');\r\n                    input_wrapper.css('align-items', 'center');\r\n                    input_wrapper.css('gap', '10px');\r\n                    \r\n                    input_wrapper.append(`\r\n                        <div class=\"custom-contact-icons\" style=\"display: flex; gap: 10px; white-space: nowrap;\">\r\n                            <a href=\"https://api.whatsapp.com/send?phone=${cleaned_number_1}\" target=\"_blank\"\r\n                               style=\"text-decoration:none;\" title=\"WhatsApp\">\r\n                                <i class=\"fa fa-whatsapp\" style=\"color:#25D366; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"tel:${phone_number_1}\" style=\"text-decoration:none;\" title=\"Call\">\r\n                                <i class=\"fa fa-phone\" style=\"color:#25D366; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"https://t.me/${cleaned_number_1}\" target=\"_blank\"\r\n                               style=\"text-decoration:none;\" title=\"Telegram\">\r\n                                <i class=\"fa fa-telegram\" style=\"color:#0088cc; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"sms:${phone_number_1}\" style=\"text-decoration:none;\" title=\"SMS\">\r\n                                <i class=\"fa fa-comment\" style=\"color:#ff9800; font-size:22px;\"></i>\r\n                            </a>\r\n                        </div>\r\n                    `);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Mobile Number 2\r\n        if (frm.doc.custom_mobile_number_2) {\r\n            let phone_number_2 = frm.doc.custom_mobile_number_2;\r\n            let cleaned_number_2 = phone_number_2.replace(/[\\s\\-\\(\\)\\+]/g, '');\r\n            \r\n            let phone_field_2 = frm.fields_dict.custom_mobile_number_2;\r\n            if (phone_field_2 && phone_field_2.$wrapper) {\r\n                phone_field_2.$wrapper.find('.custom-contact-icons').remove();\r\n                \r\n                let input_wrapper = phone_field_2.$wrapper.find('.control-input-wrapper');\r\n                if (input_wrapper.length) {\r\n                    input_wrapper.css('display', 'flex');\r\n                    input_wrapper.css('align-items', 'center');\r\n                    input_wrapper.css('gap', '10px');\r\n                    \r\n                    input_wrapper.append(`\r\n                        <div class=\"custom-contact-icons\" style=\"display: flex; gap: 10px; white-space: nowrap;\">\r\n                            <a href=\"https://api.whatsapp.com/send?phone=${cleaned_number_2}\" target=\"_blank\"\r\n                               style=\"text-decoration:none;\" title=\"WhatsApp\">\r\n                                <i class=\"fa fa-whatsapp\" style=\"color:#25D366; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"tel:${phone_number_2}\" style=\"text-decoration:none;\" title=\"Call\">\r\n                                <i class=\"fa fa-phone\" style=\"color:#25D366; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"https://t.me/${cleaned_number_2}\" target=\"_blank\"\r\n                               style=\"text-decoration:none;\" title=\"Telegram\">\r\n                                <i class=\"fa fa-telegram\" style=\"color:#0088cc; font-size:22px;\"></i>\r\n                            </a>\r\n                            \r\n                            <a href=\"sms:${phone_number_2}\" style=\"text-decoration:none;\" title=\"SMS\">\r\n                                <i class=\"fa fa-comment\" style=\"color:#ff9800; font-size:22px;\"></i>\r\n                            </a>\r\n                        </div>\r\n                    `);\r\n                }\r\n            }\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 0,
  "modified": "2025-12-21 08:12:22.427854",
  "module": "Apex CRM",
  "name": "Lead Real-time Notifications",
  "script": "// Listen for real-time notifications\nfrappe.realtime.on('lead_notification', function(data) {\n    console.log('Notification received:', data); // For debugging\n    \n    // Show visual alert\n    frappe.show_alert({\n        message: data.message,\n        indicator: data.indicator || 'blue'\n    }, 10);\n    \n    // Play sound\n    frappe.utils.play_sound('alert');\n    \n    // Show desktop notification if browser allows\n    if (Notification.permission === 'granted') {\n        new Notification(data.title, {\n            body: data.message,\n            icon: '/assets/frappe/images/frappe-icon.png'\n        });\n    }\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 0,
  "modified": "2025-12-21 08:11:33.080101",
  "module": "Apex CRM",
  "name": "Lead List View Mobile",
  "script": "frappe.listview_settings['Lead'] = {\n    add_fields: [\"lead_name\", \"company_name\", \"mobile_no\", \"email_id\", \"lead_owner\"],\n    \n    // Format how each row appears\n    onload: function(listview) {\n        // Customize list view\n    },\n    \n    // This formats the indicator color\n    get_indicator: function(doc) {\n        if(doc.status === \"Open\") {\n            return [__(\"Open\"), \"orange\", \"status,=,Open\"];\n        } else if(doc.status === \"Interested\") {\n            return [__(\"Interested\"), \"blue\", \"status,=,Interested\"];\n        }\n    }\n};\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 0,
  "modified": "2025-12-21 08:02:54.395330",
  "module": "Apex CRM",
  "name": "Lead Phone Table Styling",
  "script": "frappe.ui.form.on('Lead', {\n    refresh: function(frm) {\n        add_phone_styles();\n        add_phone_icons(frm);\n    },\n    \n    custom_phone_numbers_on_form_rendered: function(frm) {\n        setTimeout(() => add_phone_icons(frm), 300);\n    }\n});\n\nfrappe.ui.form.on('Lead Phone', {\n    phone: function(frm) {\n        setTimeout(() => add_phone_icons(frm), 200);\n    }\n});\n\nfunction add_phone_styles() {\n    if ($('#lead-phone-styles').length) return;\n    \n    $('head').append(`\n        <style id=\"lead-phone-styles\">\n            /* إخفاء عناصر الجدول غير المرغوبة */\n            [data-fieldname=\"custom_phone_numbers\"] .grid-heading-row,\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row .row-check,\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row .row-index,\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row .grid-row-check,\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row [data-action=\"edit_row\"],\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row .btn-open-row,\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row .grid-delete-row {\n                display: none !important;\n            }\n            \n            /* تنسيق الجدول */\n            [data-fieldname=\"custom_phone_numbers\"] .grid-body {\n                border: none !important;\n                background: transparent !important;\n            }\n            \n            /* تنسيق الصفوف */\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row {\n                background: white !important;\n                border: 1px solid #e2e8f0 !important;\n                border-radius: 12px !important;\n                margin-bottom: 15px !important;\n                padding: 16px 20px 16px 20px !important;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;\n                transition: all 0.2s ease !important;\n                position: relative !important;\n            }\n            \n            [data-fieldname=\"custom_phone_numbers\"] .grid-row:hover {\n                box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;\n                transform: translateY(-1px) !important;\n            }\n            \n            /* تنسيق حقل التليفون */\n            [data-fieldname=\"custom_phone_numbers\"] [data-fieldname=\"phone\"] input {\n                border: 1px solid #d1d5db !important;\n                border-radius: 10px !important;\n                padding: 10px 16px !important;\n                font-size: 15px !important;\n                font-weight: 500 !important;\n                transition: all 0.2s !important;\n            }\n            \n            [data-fieldname=\"custom_phone_numbers\"] [data-fieldname=\"phone\"] input:focus {\n                border-color: #3b82f6 !important;\n                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;\n                outline: none !important;\n            }\n            \n            /* زرار Add Row */\n            [data-fieldname=\"custom_phone_numbers\"] .grid-add-row {\n                display: inline-block !important;\n                background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;\n                color: white !important;\n                border: none !important;\n                padding: 12px 28px !important;\n                border-radius: 10px !important;\n                font-weight: 600 !important;\n                font-size: 14px !important;\n                margin-top: 15px !important;\n                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25) !important;\n                transition: all 0.2s ease !important;\n            }\n            \n            [data-fieldname=\"custom_phone_numbers\"] .grid-add-row:hover {\n                transform: translateY(-2px) !important;\n                box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35) !important;\n            }\n            \n            [data-fieldname=\"custom_phone_numbers\"] .grid-footer {\n                display: block !important;\n                border: none !important;\n            }\n            \n            /* الأيقونات */\n            .phone-icons-wrapper {\n                display: inline-flex !important;\n                gap: 10px !important;\n                position: absolute !important;\n                right: 20px !important;\n                top: 50% !important;\n                transform: translateY(-50%) !important;\n            }\n            \n            .phone-icons-wrapper a,\n            .phone-icons-wrapper .del-btn {\n                display: inline-flex !important;\n                width: 42px !important;\n                height: 42px !important;\n                border-radius: 50% !important;\n                align-items: center !important;\n                justify-content: center !important;\n                text-decoration: none !important;\n                transition: all 0.2s ease !important;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;\n                cursor: pointer !important;\n            }\n            \n            .phone-icons-wrapper a:hover,\n            .phone-icons-wrapper .del-btn:hover {\n                transform: scale(1.12) translateY(-2px) !important;\n                box-shadow: 0 4px 14px rgba(0,0,0,0.25) !important;\n            }\n            \n            .phone-icons-wrapper .wa { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important; }\n            .phone-icons-wrapper .call { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%) !important; }\n            .phone-icons-wrapper .tc { background: linear-gradient(135deg, #0066FF 0%, #0047B3 100%) !important; }\n            .phone-icons-wrapper .sms { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%) !important; }\n            .phone-icons-wrapper .del-btn { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important; }\n            \n            /* توسيع الصف للأيقونات */\n            [data-fieldname=\"custom_phone_numbers\"] .grid-row {\n                padding-right: 260px !important;\n            }\n        </style>\n    `);\n}\n\nfunction add_phone_icons(frm) {\n    if (!frm.fields_dict.custom_phone_numbers) return;\n    \n    let grid = frm.fields_dict.custom_phone_numbers.grid;\n    if (!grid || !grid.grid_rows) return;\n    \n    // تخصيص زرار Add Row\n    setTimeout(() => {\n        let add_btn = $(frm.fields_dict.custom_phone_numbers.wrapper).find('.grid-add-row');\n        if (add_btn.length && add_btn.text().trim() === 'Add Row') {\n            add_btn.html('<i class=\"fa fa-plus\" style=\"margin-right: 6px;\"></i>Add New Phone');\n        }\n    }, 100);\n    \n    grid.grid_rows.forEach(function(grid_row, idx) {\n        let phone = grid_row.doc.phone;\n        if (!phone) return;\n        \n        // إزالة الأيقونات القديمة\n        $(grid_row.row).find('.phone-icons-wrapper').remove();\n        \n        // تنظيف رقم التليفون\n        let clean = phone.replace(/[^0-9+]/g, '');\n        let clean_no_plus = clean.replace(/^\\+/, '');\n        \n        // تحديد country code للـ Truecaller\n        let country_iso = get_country_iso_from_phone(clean_no_plus);\n        let truecaller_url = `https://www.truecaller.com/search/${country_iso}/${clean_no_plus}`;\n        \n        // HTML الأيقونات\n        let icons = `\n            <div class=\"phone-icons-wrapper\">\n                <a href=\"https://api.whatsapp.com/send?phone=${clean_no_plus}\" target=\"_blank\" class=\"wa\" title=\"WhatsApp\">\n                    <svg width=\"20\" height=\"20\" fill=\"white\" viewBox=\"0 0 24 24\">\n                        <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z\"/>\n                    </svg>\n                </a>\n                \n                <a href=\"tel:${clean}\" class=\"call\" title=\"Call\">\n                    <svg width=\"20\" height=\"20\" fill=\"white\" viewBox=\"0 0 24 24\">\n                        <path d=\"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z\"/>\n                    </svg>\n                </a>\n                \n                <a href=\"${truecaller_url}\" target=\"_blank\" class=\"tc\" title=\"Truecaller\">\n                    <svg width=\"20\" height=\"20\" fill=\"white\" viewBox=\"0 0 24 24\">\n                        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z\"/>\n                    </svg>\n                </a>\n                \n                <a href=\"sms:${clean}\" class=\"sms\" title=\"SMS\">\n                    <svg width=\"20\" height=\"20\" fill=\"white\" viewBox=\"0 0 24 24\">\n                        <path d=\"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z\"/>\n                    </svg>\n                </a>\n        `;\n        \n        // زر الحذف من الرقم التاني\n        if (idx > 0) {\n            icons += `\n                <div class=\"del-btn\" data-idx=\"${idx}\" title=\"Delete\">\n                    <svg width=\"20\" height=\"20\" fill=\"white\" viewBox=\"0 0 24 24\">\n                        <path d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"/>\n                    </svg>\n                </div>\n            `;\n        }\n        \n        icons += `</div>`;\n        \n        // إضافة الأيقونات\n        $(grid_row.row).append(icons);\n        \n        // Event للحذف\n        if (idx > 0) {\n            $(grid_row.row).find('.del-btn').off('click').on('click', function() {\n                frappe.confirm(\n                    __('Delete this phone number?'),\n                    function() {\n                        frm.get_field('custom_phone_numbers').grid.grid_rows[idx].remove();\n                        frm.refresh_field('custom_phone_numbers');\n                    }\n                );\n            });\n        }\n    });\n}\n\n// Function لتحديد country ISO code من رقم التليفون\nfunction get_country_iso_from_phone(phone) {\n    // Map لأكواد الدول الشائعة في المنطقة\n    const country_codes = {\n        '20': 'eg',    // Egypt\n        '966': 'sa',   // Saudi Arabia\n        '971': 'ae',   // UAE\n        '965': 'kw',   // Kuwait\n        '974': 'qa',   // Qatar\n        '968': 'om',   // Oman\n        '973': 'bh',   // Bahrain\n        '962': 'jo',   // Jordan\n        '961': 'lb',   // Lebanon\n        '963': 'sy',   // Syria\n        '970': 'ps',   // Palestine\n        '967': 'ye',   // Yemen\n        '964': 'iq',   // Iraq\n        '212': 'ma',   // Morocco\n        '213': 'dz',   // Algeria\n        '216': 'tn',   // Tunisia\n        '218': 'ly',   // Libya\n        '249': 'sd',   // Sudan\n        '1': 'us',     // USA/Canada\n        '44': 'uk',    // UK\n    };\n    \n    // التحقق من أكواد الدول\n    for (let code in country_codes) {\n        if (phone.startsWith(code)) {\n            return country_codes[code];\n        }\n    }\n    \n    // Default: eg\n    return 'eg';\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-12-21 22:47:55.713262",
  "module": "Apex CRM",
  "name": "Lead List Duplicate Button",
  "script": "\nfrappe.listview_settings['Lead'] = {\n    onload: function (listview) {\n        listview.page.add_inner_button(__('Duplicate Manager'), function () {\n            frappe.set_route('duplicate-manager');\n        });\n    }\n};\n            ",
  "view": "List"
 }
]